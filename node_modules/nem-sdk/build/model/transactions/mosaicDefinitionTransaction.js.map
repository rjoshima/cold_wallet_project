{"version":3,"sources":["../../../src/model/transactions/mosaicDefinitionTransaction.js"],"names":["prepare","common","tx","network","kp","create","fixPrivateKey","privateKey","actualSender","isMultisig","multisigAccount","publicKey","toString","rentalFeeSink","mosaic","toUpperCase","replace","rentalFee","mosaicDefinitionTransaction","namespaceParent","fqn","mosaicName","mosaicDescription","mosaicProperties","properties","levy","due","data","testnet","id","entity","_construct","senderPublicKey","timeStamp","createNEMTimeStamp","version","getVersion","mosaicDefinition","fee","namespaceAndMosaicCommon","levyData","feeType","address","custom","Object","keys","map","key","index","extendObj","module","exports"],"mappings":"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","file":"mosaicDefinitionTransaction.js","sourcesContent":["import Network from '../network';\nimport Helpers from '../../utils/helpers';\nimport TransactionTypes from '../transactionTypes';\nimport Fees from '../fees';\nimport KeyPair from '../../crypto/keyPair';\nimport Objects from '../objects';\nimport Sinks from '../sinks';\nimport MultisigWrapper from './multisigWrapper';\n\n/**\n * Prepare a mosaic definition transaction\n *\n * @param {object} common - A common object\n * @param {object} tx - An un-prepared mosaicDefinitionTransaction object\n * @param {number} network - A network id\n *\n * @return {object} - A [MosaicDefinitionCreationTransaction]{@link http://bob.nem.ninja/docs/#mosaicDefinitionCreationTransaction} object ready for serialization\n */\nlet prepare = function(common, tx, network){\n    let kp = KeyPair.create(Helpers.fixPrivateKey(common.privateKey));\n    let actualSender = tx.isMultisig ? tx.multisigAccount.publicKey : kp.publicKey.toString();\n    let rentalFeeSink = Sinks.mosaic[network].toUpperCase().replace(/-/g, '');\n    let rentalFee = Fees.mosaicDefinitionTransaction;\n    let namespaceParent = tx.namespaceParent.fqn;\n    let mosaicName = tx.mosaicName.toString();\n    let mosaicDescription = tx.mosaicDescription.toString();\n    let mosaicProperties = tx.properties;\n    let levy = tx.levy.mosaic ? tx.levy : null;\n    let due = network === Network.data.testnet.id ? 60 : 24 * 60;\n    let entity = _construct(actualSender, rentalFeeSink, rentalFee, namespaceParent, mosaicName, mosaicDescription, mosaicProperties, levy, due, network);\n    if (tx.isMultisig) {\n        entity = MultisigWrapper(kp.publicKey.toString(), entity, due, network);\n    }\n    return entity;\n}\n\n/***\n * Create a mosaic definition transaction object\n *\n * @param {string} senderPublicKey - The sender account public key\n * @param {string} rentalFeeSink - The rental sink account\n * @param {number} rentalFee - The rental fee\n * @param {string} namespaceParent - The parent namespace\n * @param {string} mosaicName - The mosaic name\n * @param {string} mosaicDescription - The mosaic description\n * @param {object} mosaicProperties - The mosaic properties object\n * @param {object} levy - The levy object\n * @param {number} due - The deadline in minutes\n * @param {number} network - A network id\n *\n * @return {object} - A [MosaicDefinitionCreationTransaction]{@link http://bob.nem.ninja/docs/#mosaicDefinitionCreationTransaction} object\n */\nlet _construct = function(senderPublicKey, rentalFeeSink, rentalFee, namespaceParent, mosaicName, mosaicDescription, mosaicProperties, levy, due, network) {\n    let timeStamp = Helpers.createNEMTimeStamp();\n    let version = Network.getVersion(1, network);\n    let data = Objects.create(\"commonTransactionPart\")(TransactionTypes.mosaicDefinition, senderPublicKey, timeStamp, due, version);\n    let fee = Fees.namespaceAndMosaicCommon;\n    let levyData = levy ? {\n        'type': levy.feeType,\n        'recipient': levy.address.toUpperCase().replace(/-/g, ''),\n        'mosaicId': levy.mosaic,\n        'fee': levy.fee,\n    } : null;\n    let custom = {\n        'creationFeeSink': rentalFeeSink.replace(/-/g, ''),\n        'creationFee': rentalFee,\n        'mosaicDefinition': {\n            'creator': senderPublicKey,\n            'id': {\n                'namespaceId': namespaceParent,\n                'name': mosaicName,\n            },\n            'description': mosaicDescription,\n            'properties': Object.keys(mosaicProperties).map((key, index) => {\n                return { \"name\": key, \"value\": mosaicProperties[key].toString() };\n            }),\n            'levy': levyData\n        },\n        'fee': fee\n    };\n    var entity = Helpers.extendObj(data, custom);\n    return entity;\n}\n\nmodule.exports = {\n    prepare\n}"]}