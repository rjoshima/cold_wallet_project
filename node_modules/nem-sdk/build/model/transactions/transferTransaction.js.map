{"version":3,"sources":["../../../src/model/transactions/transferTransaction.js"],"names":["prepare","common","tx","network","Error","kp","create","fixPrivateKey","privateKey","actualSender","isMultisig","multisigAccount","publicKey","toString","recipientCompressedKey","recipient","amount","Math","round","message","msgFee","calculateMessage","isHW","due","data","testnet","id","mosaics","mosaicsFee","entity","_construct","prepareMosaic","mosaicDefinitionMetaDataPair","calculateMosaics","senderPublicKey","timeStamp","createNEMTimeStamp","version","getVersion","transfer","fee","currentFeeFactor","calculateMinimum","totalFee","floor","custom","toUpperCase","replace","extendObj","module","exports"],"mappings":"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","file":"transferTransaction.js","sourcesContent":["import Network from '../network';\nimport Helpers from '../../utils/helpers';\nimport TransactionTypes from '../transactionTypes';\nimport Fees from '../fees';\nimport KeyPair from '../../crypto/keyPair';\nimport Objects from '../objects';\nimport MultisigWrapper from './multisigWrapper';\nimport Message from './message';\n\n/**\n * Prepare a transfer transaction object\n *\n * @param {object} common - A common object\n * @param {object} tx - The un-prepared transfer transaction object\n * @param {number} network - A network id\n *\n * @return {object} - A [TransferTransaction]{@link http://bob.nem.ninja/docs/#transferTransaction} object ready for serialization\n */\nlet prepare = function(common, tx, network){\n    if (!common || !tx || !network) throw new Error('Missing parameter !');\n\tlet kp = KeyPair.create(Helpers.fixPrivateKey(common.privateKey));\n    let actualSender = tx.isMultisig ? tx.multisigAccount.publicKey : kp.publicKey.toString();\n    let recipientCompressedKey = tx.recipient.toString();\n    let amount = Math.round(tx.amount * 1000000);\n    let message = Message.prepare(common, tx);\n    let msgFee = Fees.calculateMessage(message, common.isHW);\n    let due = network === Network.data.testnet.id ? 60 : 24 * 60;\n    let mosaics = null;\n    let mosaicsFee = null\n    let entity = _construct(actualSender, recipientCompressedKey, amount, message, msgFee, due, mosaics, mosaicsFee, network);\n    if (tx.isMultisig) {\n        entity = MultisigWrapper(kp.publicKey.toString(), entity, due, network);\n    }\n    return entity;\n}\n\n\n/**\n * Prepare a mosaic transfer transaction object\n *\n * @param {object} common - A common object\n * @param {object} tx - The un-prepared transfer transaction object\n * @param {object} mosaicDefinitionMetaDataPair - The mosaicDefinitionMetaDataPair object with properties of mosaics to send\n * @param {number} network - A network id\n *\n * @return {object} - A [TransferTransaction]{@link http://bob.nem.ninja/docs/#transferTransaction} object ready for serialization\n */\nlet prepareMosaic = function(common, tx, mosaicDefinitionMetaDataPair, network){\n    if (!common || !tx || !mosaicDefinitionMetaDataPair || tx.mosaics === null || !network) throw new Error('Missing parameter !');\n    let kp = KeyPair.create(Helpers.fixPrivateKey(common.privateKey));\n    let actualSender = tx.isMultisig ? tx.multisigAccount.publicKey : kp.publicKey.toString();\n    let recipientCompressedKey = tx.recipient.toString();\n    let amount = Math.round(tx.amount * 1000000);\n    let message = Message.prepare(common, tx);\n    let msgFee = Fees.calculateMessage(message, common.isHW);\n    let due = network === Network.data.testnet.id ? 60 : 24 * 60;\n    let mosaics = tx.mosaics;\n    let mosaicsFee = Fees.calculateMosaics(amount, mosaicDefinitionMetaDataPair, mosaics);\n    let entity = _construct(actualSender, recipientCompressedKey, amount, message, msgFee, due, mosaics, mosaicsFee, network);\n    if (tx.isMultisig) {\n        entity = MultisigWrapper(kp.publicKey.toString(), entity, due, network);\n    }\n    return entity;\n}\n\n/***\n * Create a transfer transaction object\n *\n * @param {string} senderPublicKey - The sender account public key\n * @param {string} recipientCompressedKey - The recipient account public key\n * @param {number} amount - The amount to send in micro XEM\n * @param {object} message - The message object\n * @param {number} due - The deadline in minutes\n * @param {array} mosaics - The array of mosaics to send\n * @param {number} mosaicFee - The fees for mosaics included in the transaction\n * @param {number} network - A network id\n *\n * @return {object} - A [TransferTransaction]{@link http://bob.nem.ninja/docs/#transferTransaction} object\n */\nlet _construct = function(senderPublicKey, recipientCompressedKey, amount, message, msgFee, due, mosaics, mosaicsFee, network) {\n    let timeStamp = Helpers.createNEMTimeStamp();\n    let version = mosaics ? Network.getVersion(2, network) : Network.getVersion(1, network);\n    let data = Objects.create(\"commonTransactionPart\")(TransactionTypes.transfer, senderPublicKey, timeStamp, due, version);\n    let fee = mosaics ? mosaicsFee : Fees.currentFeeFactor * Fees.calculateMinimum(amount / 1000000);\n    let totalFee = Math.floor((msgFee + fee) * 1000000);\n    let custom = {\n        'recipient': recipientCompressedKey.toUpperCase().replace(/-/g, ''),\n        'amount': amount,\n        'fee': totalFee,\n        'message': message,\n        'mosaics': mosaics\n    };\n    let entity = Helpers.extendObj(data, custom);\n    return entity;\n}\n\nmodule.exports = {\n    prepare,\n    prepareMosaic\n}"]}